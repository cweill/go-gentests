name: Go

on:
  push:
    branches: [ develop ]
  pull_request:
    branches: [ develop ]

jobs:

  test:
    name: Test
    strategy:
      matrix:
        go-version: [1.9.x, 1.10.x]
        os: [ubuntu-latest]
    runs-on: ${{ matrix.os }}
    env:
      GOPATH: ${{ github.workspace }}
      GO111MODULE: auto
    defaults:
      run:
        working-directory: ${{ env.GOPATH }}/src/github.com/cweill/gotests
    steps:

    - name: Set up Go 1.x
      uses: actions/setup-go@v2
      with:
        go-version: ${{ matrix.go-version }}

    - name: Check out code into the Go module directory
      uses: actions/checkout@v2
      with:
        path: src/github.com/cweill/gotests

    - name: Get dependencies
      run: |
        go get github.com/mattn/goveralls
        go get github.com/tools/cmd/cover || go get golang.org/x/tools/cmd/cover
        go get -v ./...

    - name: Test
      run: go test ./...
      
    - name: Coverage
      run: go test -c -covermode=count -coverpkg=github.com/cweill/gotests,github.com/cweill/gotests/internal/input,github.com/cweill/gotests/internal/render,github.com/cweill/gotests/internal/goparser,github.com/cweill/gotests/internal/output,github.com/cweill/gotests/internal/models
